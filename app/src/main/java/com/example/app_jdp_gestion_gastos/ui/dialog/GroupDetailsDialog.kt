package com.example.app_jdp_gestion_gastos.ui.dialogimport android.app.Dialogimport android.os.Bundleimport android.view.LayoutInflaterimport android.view.Viewimport androidx.fragment.app.DialogFragmentimport com.example.app_jdp_gestion_gastos.data.model.Groupimport com.example.app_jdp_gestion_gastos.databinding.DialogGroupDetailsBindingimport com.google.firebase.Timestampimport com.google.firebase.firestore.FirebaseFirestoreimport java.text.SimpleDateFormatimport java.util.Localeclass GroupDetailsDialog : DialogFragment() {    private var _binding: DialogGroupDetailsBinding? = null    private val binding get() = _binding!!    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {        _binding = DialogGroupDetailsBinding.inflate(LayoutInflater.from(context))        val group = arguments?.getSerializable("group") as? Group            ?: throw IllegalArgumentException("Group is required")        // Configurar la vista con los datos del grupo        binding.apply {            tvGroupName.text = group.name            getUserName(group.createdBy) // Obtener nombre del usuario creador            tvMembers.text = "Miembros: ${group.members.joinToString(", ")}"            tvCreatedAt.text = "Fecha de creación: ${formatTimestamp(group.createdAt)}"            tvExpenses.text = "Gastos: ${group.expenses.joinToString(", ")}"            btnClose.setOnClickListener {                dismiss()            }        }        return Dialog(requireContext()).apply {            setContentView(binding.root)        }    }    override fun onDestroyView() {        super.onDestroyView()        _binding = null    }    companion object {        fun newInstance(group: Group): GroupDetailsDialog {            val args = Bundle().apply {                putSerializable("group", group)            }            return GroupDetailsDialog().apply {                arguments = args            }        }    }    private fun formatTimestamp(timestamp: Timestamp?): String {        return timestamp?.toDate()?.let {            val sdf = SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault())            sdf.format(it)        } ?: "Fecha no disponible"    }    // Función para obtener el nombre del usuario creador    private fun getUserName(userId: String) {        val db = FirebaseFirestore.getInstance()        db.collection("users").document(userId).get()            .addOnSuccessListener { document ->                if (document.exists()) {                    val userName = document.getString("name") ?: "Desconocido"                    binding.tvCreatedBy.text = "Creado por: $userName"                } else {                    binding.tvCreatedBy.text = "Creado por: No encontrado"                }            }            .addOnFailureListener {                binding.tvCreatedBy.text = "Creado por: Error al cargar"            }    }}