package com.example.app_jdp_gestion_gastos.ui.viewmodelimport androidx.lifecycle.LiveDataimport androidx.lifecycle.MutableLiveDataimport androidx.lifecycle.ViewModelimport androidx.lifecycle.viewModelScopeimport com.example.app_jdp_gestion_gastos.data.repository.StatsRepositoryimport kotlinx.coroutines.launchimport java.util.Calendarclass StatsViewModel(private val statsRepository: StatsRepository) : ViewModel() {    private val _totalGastos = MutableLiveData<Double>()    val totalGastos: LiveData<Double> get() = _totalGastos    private val _totalIngresos = MutableLiveData<Double>()    val totalIngresos: LiveData<Double> get() = _totalIngresos    private val _promedioGastos = MutableLiveData<Double>()    val promedioGastos: LiveData<Double> get() = _promedioGastos    private val _numTransaccionesIngresos = MutableLiveData<Int>()    val numTransaccionesIngresos: LiveData<Int> get() = _numTransaccionesIngresos    private val _numTransaccionesGastos = MutableLiveData<Int>()    val numTransaccionesGastos: LiveData<Int> get() = _numTransaccionesGastos    fun loadStats() {        viewModelScope.launch {            val expenses = statsRepository.getExpenses()            val incomes = statsRepository.getIncomes()            // Fecha actual            val currentCalendar = Calendar.getInstance()            val currentMonth = currentCalendar.get(Calendar.MONTH)            val currentYear = currentCalendar.get(Calendar.YEAR)            // Filtrar transacciones del mes actual            val currentMonthExpenses = expenses.filter { expense ->                expense.date?.toDate()?.let {                    val calendar = Calendar.getInstance().apply { time = it }                    calendar.get(Calendar.MONTH) == currentMonth &&                            calendar.get(Calendar.YEAR) == currentYear                } ?: false            }            val currentMonthIncomes = incomes.filter { income ->                income.date?.toDate()?.let {                    val calendar = Calendar.getInstance().apply { time = it }                    calendar.get(Calendar.MONTH) == currentMonth &&                            calendar.get(Calendar.YEAR) == currentYear                } ?: false            }            val totalExpensesAmount = currentMonthExpenses.sumOf { it.amount }            val totalIncomesAmount = currentMonthIncomes.sumOf { it.amount }            val monthlyBalance = totalIncomesAmount - totalExpensesAmount            _totalGastos.postValue(totalExpensesAmount)            _totalIngresos.postValue(totalIncomesAmount)            _promedioGastos.postValue(monthlyBalance)            _numTransaccionesGastos.postValue(currentMonthExpenses.size)            _numTransaccionesIngresos.postValue(currentMonthIncomes.size)        }    }}